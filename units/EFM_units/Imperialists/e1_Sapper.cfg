#textdomain wesnoth-Ageless_Era

[unit_type]
    id=AE_efm_imperialists_Sapper
    name= _ "Sapper"
    race=AE_efm_imperialists_race
    ignore_race_traits=yes
    image="units/imperialists/sapper.png"
    hitpoints=14
    movement_type=smallfoot
    movement=5
    experience=100
    level=0
    alignment=neutral
    advances_to=null
    {AMLA_DEFAULT}
    cost=8
    usage=fighter
    description={AE_EFM_UNIT_NOTICE}+"The sappers are all slaves who have been given the opportunity to die honorably. The legions rarely run short on volunteers as many of the conquered people were proud folk who would rather die in battle than be a servant for the rest of their lives. It is not unknown for free citizens to take the role too if they feel sufficiently disgraced. Note: Their attack reduces their targets current hitpoints by the % of their current defense.(Capped at 20 damage, for units higher than level 1 at 15 damage) (Example: a thirty hitpoint unit standing on 50% defense terrain attacked by a sapper would take 15 damage)."

    die_sound={SOUND_LIST:HUMAN_DIE}
    undead_variation=human

    [resistance]
        arcane=80
        fire=200
    [/resistance]

    [attack]
        name=suicide
        description= _ "light the fuse"
        type=fire
        range=sapper
        damage=0
        number=1
        icon=attacks/fireball.png
        [specials]
            {AE_DUMMY_WEAPON_SPECIAL_SAPPER}
            {WEAPON_SPECIAL_AE_MAG_ALWAYSHITS}
        [/specials]
    [/attack]

    [standing_anim]
        [frame]
            image="units/imperialists/sapper.png"
            duration=150
        [/frame]
        [frame]
            image="units/imperialists/sapper1.png"
            duration=150
        [/frame]
        [frame]
            image="units/imperialists/sapper2.png"
            duration=150
        [/frame]
        [frame]
            image="units/imperialists/sapper3.png"
            duration=150
        [/frame]
    [/standing_anim]

    [event]
        name=attacker_hits
        first_time_only=no
        id=AE_efm_sapper_event
        [filter_attack]
            special=AE_efm_weapon_special_sapper
        [/filter_attack]

        # based on http://forums.wesnoth.org/viewtopic.php?f=21&t=29379
        [lua]
            code=<<
			local id = wml.variables["second_unit.id"]
			local u = wesnoth.units.get(id)
			local def = wesnoth.unit_defense(u, wesnoth.get_terrain(u.x, u.y))
			wml.variables["targetDefense"] = def
		>>
        [/lua]
        {VARIABLE_OP targetDefense multiply 0.01}
        [sound]
            name=fuse.ogg
        [/sound]
        #{MODIFY_UNIT x,y=$x1,$y1 image "halo/inf4.png"}
        #[delay]
        #    time=1200
        #[/delay]
        [store_unit]
            [filter]
                x,y=$x2,$y2
            [/filter]
            variable=sapperTarget
        [/store_unit]
        [set_variable]
            name=temp
            to_variable=sapperTarget.hitpoints
        [/set_variable]
        [set_variable]
            name=temp
            multiply=$targetDefense
        [/set_variable]
        [set_variable]
            name=BOOMdamage
            to_variable=sapperTarget.hitpoints
        [/set_variable]
        [set_variable]
            name=BOOMdamage
            sub=$temp
        [/set_variable]
        [if]
            [variable]
                name=BOOMdamage
                greater_than=20
            [/variable]
            [then]
                [set_variable]
                    name=BOOMdamage
                    value=20
                [/set_variable]
            [/then]
        [/if]
        [if]
            [variable]
                name=BOOMdamage
                greater_than=15
            [/variable]
            [and]
                [variable]
                    name=second_unit.level
                    greater_than=1
                [/variable]
            [/and]
            [then]
                [set_variable]
                    name=BOOMdamage
                    value=15
                [/set_variable]
            [/then]
        [/if]
        [set_variable]
            name=sapperTarget.hitpoints
            sub=$BOOMdamage
        [/set_variable]
        [unstore_unit]
            variable=sapperTarget
            text= _ "Boom!"
        [/unstore_unit]
        [kill]
            x,y=$x1,$y1
            animate=yes
        [/kill]
        [sound]
            name=explosion.ogg
        [/sound]
    [/event]

    #[event]
    #    name=start
    #    {VARIABLE targetDefense .5}
    #    {VARIABLE temp 0}
    #[/event]

    [attack_anim]
        [filter_attack]
            name=suicide
        [/filter_attack]
        direction=s,se,sw
        missile_start_time=0
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-1.png~FL(vert)"
            offset=1.0
            sound=explosion.ogg
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-2.png~FL(vert)"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-3.png~FL(vert)"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-4.png~FL(vert)"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-5.png~FL(vert)"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-6.png~FL(vert)"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-7.png~FL(vert)"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-8.png~FL(vert)"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-9.png~FL(vert)"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-10.png~FL(vert)"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-11.png~FL(vert)"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-12.png~FL(vert)"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-13.png~FL(vert)"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-14.png~FL(vert)"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-15.png~FL(vert)"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-16.png~FL(vert)"
            offset=1.0
        [/missile_frame]
        [frame]
            begin=0
            end=960
            image="misc/blank-hex.png"
        [/frame]
    [/attack_anim]
    [attack_anim]
        [filter_attack]
            name=suicide
        [/filter_attack]
        direction=n,ne,nw
        missile_start_time=0
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-1.png"
            offset=1.0
            sound=explosion.ogg
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-2.png"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-3.png"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-4.png"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-5.png"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-6.png"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-7.png"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-8.png"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-9.png"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-10.png"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-11.png"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-12.png"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-13.png"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-14.png"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-15.png"
            offset=1.0
        [/missile_frame]
        [missile_frame]
            duration=60
            halo="projectiles/fireball-impact-16.png"
            offset=1.0
        [/missile_frame]
        [frame]
            begin=0
            end=960
            image="misc/blank-hex.png"
        [/frame]
    [/attack_anim]
[/unit_type]
